import{d as A,n as G,r as y,V as k,_ as $,o as W,b as j,e as H}from"./index.36e2076f.js";import{P as R}from"./point.4d2fb8c9.js";let _=[];const N=(s,f)=>{_=[];let l=Math.floor(s.width/f)-1,e=Math.floor(s.height/f)-1;for(let a=0;a<l*e;a++)_.push(!1)},O=(s,f,l,e)=>{let a=Math.floor(e/f),r=Math.floor(l/f);for(let X=0;X<a;X++)s.beginPath(),s.moveTo(0,f*X),s.lineTo((r-1)*f,f*X),s.strokeStyle="#ccc",s.stroke();for(let X=0;X<r;X++)s.beginPath(),s.moveTo(f*X,0),s.lineTo(f*X,(a-1)*f),s.strokeStyle="#ccc",s.stroke()},Z=(s,f,l,e)=>{let a=null,r,X,Y=0,c=-.5;if(l.Y==e.Y){for(l.X>e.X&&(a=l,l=e,e=a),X=l.X;X<e.X;X++)M(s,X,l.Y,f);return}if(l.X==e.X){for(l.Y>e.Y&&(a=l,l=e,e=a),Y=l.Y;Y<e.Y;Y++)M(s,l.X,Y,f);return}if(r=(e.Y-l.Y)/(e.X-l.X),r>0&&r<=1)for(l.X>e.X&&(a=l,l=e,e=a),c=-.5,X=l.X,Y=l.Y;X<e.X;)M(s,X,Y,f),c=c+r,c>0&&(Y++,c=c-1),X++;else if(r>=-1&&r<0)for(l.X>e.X&&(a=l,l=e,e=a),c=.5,X=l.X,Y=l.Y;X<e.X;)M(s,X,Y,f),c=c+r,c<0&&(Y--,c=c+1),X++;else if(r>1)for(l.Y>e.Y&&(a=l,l=e,e=a),c=-.5,X=l.X,Y=l.Y;Y<e.Y;)M(s,X,Y,f),c=c+1/r,c>0&&(X=X+1,c=c-1),Y++;else for(l.Y>e.Y&&(a=l,l=e,e=a),c=.5,X=l.X,Y=l.Y;Y<e.Y;)M(s,X,Y,f),c=c+1/r,c<0&&(X--,c=c+1),Y++},M=(s,f,l,e)=>{let a=s.data;if(f>s.width||f<0||l>s.height||l<0)return;f=Math.floor(f),l=Math.floor(l);const r=(f+l*s.width)*4;a[r+0]=e.X,a[r+1]=e.Y,a[r+2]=e.Z,a[r+3]=255},q=(s,f,l,e,a)=>{e.X>f||e.X<0||e.Y>l||e.Y<0||a.X>f||a.X<0||a.Y>l||a.Y<0||(s.moveTo(e.X,e.Y),s.lineTo(a.X,a.Y))},J=(s,f,l,e,a,r)=>{let X=null,Y,c,h=0,u=-.5;if(a.Y==r.Y){for(a.X>r.X&&(X=a,a=r,r=X),c=a.X;c<r.X;c++)v(s,f,c,a.Y,l,e);return}if(a.X==r.X){for(a.Y>r.Y&&(X=a,a=r,r=X),h=a.Y;h<r.Y;h++)v(s,f,a.X,h,l,e);return}if(Y=(r.Y-a.Y)/(r.X-a.X),Y>0&&Y<=1)for(a.X>r.X&&(X=a,a=r,r=X),u=-.5,c=a.X,h=a.Y;c<r.X;)v(s,f,c,h,l,e),u=u+Y,u>0&&(h++,u=u-1),c++;else if(Y>=-1&&Y<0)for(a.X>r.X&&(X=a,a=r,r=X),u=.5,c=a.X,h=a.Y;c<r.X;)v(s,f,c,h,l,e),u=u+Y,u<0&&(h--,u=u+1),c++;else if(Y>1)for(a.Y>r.Y&&(X=a,a=r,r=X),u=-.5,c=a.X,h=a.Y;h<r.Y;)v(s,f,c,h,l,e),u=u+1/Y,u>0&&(c=c+1,u=u-1),h++;else for(a.Y>r.Y&&(X=a,a=r,r=X),u=.5,c=a.X,h=a.Y;h<r.Y;)v(s,f,c,h,l,e),u=u+1/Y,u<0&&(c--,u=u+1),h++},v=(s,f,l,e,a,r)=>{if(l>Math.floor(a/f)-1||l<0||e>Math.floor(r/f)-1||e<0)return;let X=l*f,Y=e*f,c=Math.floor(a/f)-1;_[l*c+e]||(_[l*c+e]=!0,s.fillRect(X,Y,f,f))},E=s=>{let f=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,l=s.toLowerCase();if(f.test(l)){if(l.length===4){let a="#";for(let r=1;r<4;r+=1)a+=l.slice(r,r+1).concat(l.slice(r,r+1));l=a}let e=[];for(let a=1;a<7;a+=2)e.push(parseInt("0x"+l.slice(a,a+2)));return e}else return[0,0,0]},K={category:"SoftwareRenderer",name:"DrawFrame",buttonContent:"\u67E5\u770B\u6E90\u7801",title:"\u7ED8\u5236\u6A21\u578B\u7EBF\u6846",content:"Draw model wireframe."},Q=A({name:"DrawFrame",components:{nano_cg_experiment_page:G},setup(){const s=y();let f,l,e=y(),a,r,X,Y,c=[];const h=()=>{var p,t;f=s.value.getCanvas(),l=s.value.getContext(),e=s.value.getModel(),a=s.value.getImgData(),r=s.value.getSectionParams(),X=s.value.getWorldToScreen,Y=(p=e.value)!=null&&p.getVertByFaceMap?(t=e.value)==null?void 0:t.getVertByFaceMap:(C,I)=>k},u=()=>{F[s.value.getDrawModel()]()},F={Grid:()=>{N(f,r.girdSize),O(l,r.girdSize,f.width,f.height);const p=E(r.color);l.fillStyle="rgb("+p[0]+","+p[1]+","+p[2]+")";const t=[l,r.girdSize,f.width,f.height];B(J,t)},ImgData:()=>{a=l.createImageData(f.width,f.height);const p=E(r.color),t=[a,new k(p[0],p[1],p[2])];B(Z,t),l.putImageData(a,0,0)},CanvasApi:()=>{l.beginPath(),l.strokeStyle=r.color;const p=[l,f.width,f.height];B(q,p),l.stroke()}},B=(p,t)=>{var I;let C=s.value.getOffset();if(!c.length)(I=e.value)==null||I.facetVrt.forEach((D,m)=>{for(let w=0;w<3;w++){let L=Y.call(e.value,m,w),V=Y.call(e.value,m,(w+1)%3),o=X(L),T=X(V);c.push([o,T]),p(...t,o,T)}});else{let D=new R(0,0),m=new R(0,0);c.forEach(w=>{D.X=w[0].X+C.x,D.Y=w[0].Y+C.y,m.X=w[1].X+C.x,m.Y=w[1].Y+C.y,p(...t,D,m)})}};return{desData:K,page:s,Init:h,Render:u,ModelChange:()=>{c=[]},DrawModelChange:()=>{u()}}}});function U(s,f,l,e,a,r){const X=H("nano_cg_experiment_page");return W(),j(X,{prop_des_data:s.desData,onInit:s.Init,onRender:s.Render,onModelChange:s.ModelChange,onDrawModelChange:s.DrawModelChange,ref:"page"},null,8,["prop_des_data","onInit","onRender","onModelChange","onDrawModelChange"])}const g=$(Q,[["render",U]]);export{g as default};
